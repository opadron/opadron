#! /usr/bin/env bash

source "$( dirname "$0" )/dot-bashrc.d/commonlib"

src="$( realpath "$( dirname "$( realpath "$0" )" )" )"
dst="$1"
if [ -z "$dst" ] ; then
    dst="$HOME"
fi

if [ "$src" '=' "$dst" ] ; then
    echo "error: cannot run $0 from within its own directory" 1>&2
    exit 1
fi

exclusion_list=(
    "$( basename "$( realpath "$0" )" )"
    LICENSE
)

cd "$src"
for path in * ; do
    is_excluded=0
    for ((i=0; i<${#exclusion_list[@]}; ++i)) ; do
        if [ "$path" '=' "${exclusion_list[i]}" ] ; then
            is_excluded=1
            break
        fi
    done

    if [ "$is_excluded" '=' '1' ] ; then continue ; fi

    tmp_dst="$dst/$path"
    if [ "${path:0:4}" '=' 'dot-' ] ; then
        tmp_dst="$dst/.${path:4}"
    fi

    rm -rf "$tmp_dst"
    cp -r "$path" "$tmp_dst"
done

