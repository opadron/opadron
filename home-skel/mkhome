#! /usr/bin/env bash

source "$( dirname "$0" )/dot-bashrc.d/commonlib"

src="$( realpath "$( dirname "$( realpath "$0" )" )" )"
dst="$( realpath . )"

if [ "$src" '=' "$dst" ] ; then
    echo "error: cannot run $0 from within its own directory" 1>&2
    exit 1
fi

self="$( basename "$( realpath "$0" )" )"
cd "$src"
for path in * ; do
    if [ "$path" '=' "$self" ] ; then continue ; fi

    tmp_dst="$dst/$path"
    if [ "${path:0:4}" '=' 'dot-' ] ; then
        tmp_dst="$dst/.${path:4}"
    fi

    rm -rf "$tmp_dst"
    cp -r "$path" "$tmp_dst"
done

